<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
  <title>Socket.IO Quantum Client v3.1</title>
  
  <script src="https://cdn.socket.io/4.6.0/socket.io.min.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&family=Rajdhani:wght@400;600;700&display=swap" rel="stylesheet">

  <style>
    :root {
      --primary: #00f2ea;
      --primary-glow: rgba(0, 242, 234, 0.4);
      --secondary: #ff0050;
      --secondary-glow: rgba(255, 0, 80, 0.4);
      --bg-dark: #050510;
      --glass: rgba(16, 18, 27, 0.6);
      --glass-border: rgba(255, 255, 255, 0.08);
      --text-main: #e0e0e0;
      --text-muted: #6b7280;
      --success: #00f2ea;
    }

    * { margin: 0; padding: 0; box-sizing: border-box; }

    body {
      font-family: 'Rajdhani', sans-serif;
      background-color: var(--bg-dark);
      color: var(--text-main);
      height: 100vh;
      width: 100vw;
      overflow: hidden;
      display: flex;
      justify-content: center;
      align-items: center;
    }

    /* --- BACKGROUND FX --- */
    #canvas-bg {
      position: fixed; top: 0; left: 0; width: 100%; height: 100%;
      z-index: 0; pointer-events: none;
    }

    /* CRT Scanline Effect */
    .scanlines {
      position: fixed; top: 0; left: 0; width: 100%; height: 100%;
      background: linear-gradient(to bottom, rgba(255,255,255,0), rgba(255,255,255,0) 50%, rgba(0,0,0,0.1) 50%, rgba(0,0,0,0.1));
      background-size: 100% 4px;
      z-index: 5; pointer-events: none; opacity: 0.3;
    }

    /* --- LAYOUT --- */
    .app-container {
      position: relative; z-index: 10;
      width: 95%; max-width: 1200px; height: 90vh;
      background: var(--glass);
      backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px);
      border: 1px solid var(--glass-border);
      border-radius: 24px;
      box-shadow: 0 0 40px rgba(0,0,0,0.6), inset 0 0 0 1px rgba(255,255,255,0.05);
      display: grid;
      grid-template-columns: 320px 1fr;
      overflow: hidden;
      animation: appear 0.8s cubic-bezier(0.22, 1, 0.36, 1);
    }

    /* --- SIDEBAR --- */
    .sidebar {
      border-right: 1px solid var(--glass-border);
      display: flex; flex-direction: column;
      background: rgba(0,0,0,0.2);
      z-index: 20; transition: transform 0.4s cubic-bezier(0.22, 1, 0.36, 1);
    }

    .config-panel { padding: 25px 20px; border-bottom: 1px solid var(--glass-border); }

    .brand {
      font-family: 'JetBrains Mono', monospace;
      font-size: 1.2rem; font-weight: 700;
      color: var(--primary); margin-bottom: 20px;
      display: flex; align-items: center; gap: 12px;
      text-shadow: 0 0 10px var(--primary-glow);
    }
    .brand i { animation: spin 10s linear infinite; }

    /* Inputs */
    .input-group { position: relative; margin-bottom: 15px; }
    .input-group i {
      position: absolute; left: 14px; top: 50%; transform: translateY(-50%);
      color: var(--text-muted); font-size: 0.8rem; transition: color 0.3s;
    }
    input, textarea {
      width: 100%; background: rgba(0,0,0,0.2);
      border: 1px solid var(--glass-border);
      padding: 12px 12px 12px 40px;
      border-radius: 12px; color: white;
      font-family: 'JetBrains Mono', monospace; font-size: 0.85rem;
      outline: none; transition: all 0.3s ease;
    }
    input:focus, textarea:focus {
      border-color: var(--primary);
      background: rgba(0, 242, 234, 0.05);
      box-shadow: 0 0 15px rgba(0, 242, 234, 0.1);
    }
    .input-group:focus-within i { color: var(--primary); }

    /* Buttons */
    .btn {
      width: 100%; padding: 12px; border: none; border-radius: 12px;
      font-weight: 700; font-family: 'Rajdhani', sans-serif; letter-spacing: 1px;
      cursor: pointer; display: flex; justify-content: center; align-items: center; gap: 8px;
      transition: all 0.2s; position: relative; overflow: hidden;
    }
    .btn::after {
      content: ''; position: absolute; top: 0; left: -100%; width: 100%; height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
      transition: 0.5s;
    }
    .btn:hover::after { left: 100%; }
    .btn:active { transform: scale(0.97); }

    .btn-primary { 
      background: var(--primary); color: #000; 
      box-shadow: 0 0 20px var(--primary-glow);
    }
    .btn-danger { 
      background: rgba(255, 0, 80, 0.1); color: var(--secondary); border: 1px solid var(--secondary); 
      box-shadow: 0 0 15px var(--secondary-glow);
    }
    .btn-secondary { 
      background: rgba(255,255,255,0.05); color: white; border: 1px solid var(--glass-border); 
    }
    .btn-secondary:hover { background: rgba(255,255,255,0.1); }
    .btn-icon { width: 40px; padding: 0; }

    /* Logs */
    .log-area {
      flex: 1; overflow-y: auto; padding: 15px;
      font-family: 'JetBrains Mono', monospace; font-size: 0.7rem;
      background: rgba(0,0,0,0.3);
      scrollbar-width: thin; scrollbar-color: var(--primary) transparent;
    }
    .log-entry { 
      margin-bottom: 8px; padding: 4px 8px; 
      border-left: 2px solid #333; opacity: 0; 
      animation: slideInLeft 0.3s forwards;
    }
    .log-entry.success { border-color: var(--success); color: #a7f3d0; background: linear-gradient(90deg, rgba(0,242,234,0.1), transparent); }
    .log-entry.error { border-color: var(--secondary); color: #fca5a5; background: linear-gradient(90deg, rgba(255,0,80,0.1), transparent); }
    .log-entry.info { border-color: var(--text-muted); color: var(--text-muted); }

    /* --- CHAT AREA --- */
    .main-content {
      display: flex; flex-direction: column; height: 100%; position: relative;
    }

    .chat-header {
      padding: 15px 25px;
      border-bottom: 1px solid var(--glass-border);
      display: flex; justify-content: space-between; align-items: center;
      background: rgba(255,255,255,0.02);
    }
    
    .status-badge {
      padding: 6px 14px; border-radius: 30px; font-size: 0.75rem; font-weight: 700; text-transform: uppercase;
      letter-spacing: 1px; display: flex; align-items: center; gap: 6px;
      transition: all 0.3s;
    }
    .status-dot { width: 8px; height: 8px; border-radius: 50%; background: currentColor; }
    .connected { 
      background: rgba(0, 242, 234, 0.1); color: var(--primary); border: 1px solid rgba(0,242,234,0.3);
      box-shadow: 0 0 15px var(--primary-glow);
    }
    .connected .status-dot { animation: pulse 1.5s infinite; }
    .disconnected { background: rgba(255, 0, 80, 0.1); color: var(--secondary); border: 1px solid rgba(255,0,80,0.3); }

    /* Chat Messages */
    #chatBox {
      flex: 1; padding: 25px;
      overflow-y: auto; overflow-x: hidden;
      display: flex; flex-direction: column; gap: 18px;
    }

    .message {
      max-width: 80%; width: fit-content;
      padding: 14px 18px; border-radius: 18px;
      font-size: 0.95rem; line-height: 1.5; position: relative;
      animation: popIn 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
      box-shadow: 0 4px 15px rgba(0,0,0,0.2);
    }

    .message.me {
      align-self: flex-end;
      background: linear-gradient(135deg, var(--primary), #00a8ff);
      color: #050510; font-weight: 600;
      border-bottom-right-radius: 4px;
    }

    .message.other {
      align-self: flex-start;
      background: rgba(255,255,255,0.08);
      border: 1px solid var(--glass-border);
      color: white;
      border-bottom-left-radius: 4px;
    }
    
    .message-meta {
      font-size: 0.65rem; opacity: 0.7; margin-top: 4px; display: block; text-align: right;
    }

    /* Typing Indicator */
    .typing-wrapper { min-height: 24px; padding: 0 25px; margin-bottom: 5px; }
    .typing-indicator {
      display: none; font-size: 0.75rem; color: var(--primary);
      font-family: 'JetBrains Mono';
    }

    /* Controls */
    .chat-controls {
      padding: 20px; background: rgba(0,0,0,0.3);
      border-top: 1px solid var(--glass-border);
    }

    /* Mobile */
    .menu-toggle { display: none; background: none; border: none; color: white; font-size: 1.4rem; cursor: pointer; }
    .overlay {
      position: fixed; inset: 0; background: rgba(0,0,0,0.8); z-index: 15;
      opacity: 0; pointer-events: none; transition: 0.3s; backdrop-filter: blur(5px);
    }
    .overlay.active { opacity: 1; pointer-events: all; }

    /* --- ANIMATIONS --- */
    @keyframes spin { 100% { transform: rotate(360deg); } }
    @keyframes appear { from { opacity: 0; transform: scale(0.95); } to { opacity: 1; transform: scale(1); } }
    @keyframes popIn { from { opacity: 0; transform: translateY(20px) scale(0.9); } to { opacity: 1; transform: translateY(0) scale(1); } }
    @keyframes slideInLeft { from { opacity: 0; transform: translateX(-10px); } to { opacity: 1; transform: translateX(0); } }
    @keyframes pulse { 0% { box-shadow: 0 0 0 0 rgba(0, 242, 234, 0.7); } 70% { box-shadow: 0 0 0 6px rgba(0, 242, 234, 0); } 100% { box-shadow: 0 0 0 0 rgba(0, 242, 234, 0); } }

    @media (max-width: 768px) {
      .app-container { width: 100%; height: 100%; border-radius: 0; border: none; grid-template-columns: 1fr; }
      .sidebar {
        position: absolute; top: 0; left: 0; width: 85%; height: 100%;
        background: #0b0d14; transform: translateX(-100%);
      }
      .sidebar.active { transform: translateX(0); box-shadow: 20px 0 50px rgba(0,0,0,0.8); }
      .menu-toggle { display: block; }
      .action-row .btn { font-size: 0.75rem; }
    }
  </style>
</head>

<body>
  <div class="scanlines"></div>
  <canvas id="canvas-bg"></canvas>
  <div class="overlay" onclick="toggleSidebar()"></div>

  <div class="app-container">
    <div class="sidebar" id="sidebar">
      <div class="config-panel">
        <div class="brand">
          <i class="fas fa-atom"></i> QC_V3.1
          <button class="btn btn-secondary btn-icon" onclick="toggleMute()" style="margin-left:auto; width:32px; height:32px;">
            <i class="fas fa-volume-up" id="muteIcon"></i>
          </button>
        </div>
        
        <div class="input-group">
          <i class="fas fa-globe"></i>
          <input id="serverUrl" value="http://localhost:5000" placeholder="Server URL" />
        </div>
        
        <div class="input-group">
          <i class="fas fa-shield-alt"></i>
          <input id="token" type="password" placeholder="Auth Token (Optional)" />
        </div>

        <button class="btn btn-primary" id="connectBtn" onclick="toggleConnection()">
          <i class="fas fa-bolt"></i> INITIALIZE LINK
        </button>

        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 20px;">
          <div style="background:rgba(255,255,255,0.05); padding:10px; border-radius:8px; text-align:center;">
             <div style="font-size:0.7rem; color:var(--text-muted);">LATENCY</div>
             <div id="pingDisplay" style="font-family:'JetBrains Mono'; color:var(--primary);">-- ms</div>
          </div>
          <div style="background:rgba(255,255,255,0.05); padding:10px; border-radius:8px; text-align:center;">
            <div style="font-size:0.7rem; color:var(--text-muted);">UPTIME</div>
            <div id="timeDisplay" style="font-family:'JetBrains Mono';">00:00</div>
         </div>
        </div>
      </div>

      <div class="config-panel" style="padding: 10px 20px; display:flex; justify-content:space-between; align-items:center; border-bottom:none;">
        <span style="font-size:0.7rem; font-weight:700; color:var(--text-muted); letter-spacing:1px;">SYSTEM LOGS</span>
        <button class="btn btn-danger" style="width:auto; padding:4px 10px; font-size:0.65rem;" onclick="clearLogs()">
          <i class="fas fa-trash"></i>
        </button>
      </div>
      
      <div id="logContainer" class="log-area"></div>
    </div>

    <div class="main-content">
      <div class="chat-header">
        <button class="menu-toggle" onclick="toggleSidebar()">
          <i class="fas fa-bars"></i>
        </button>
        <h2 style="font-size:1.1rem; letter-spacing:1px; margin:0;"><i class="fas fa-broadcast-tower"></i> LIVE CHANNEL</h2>
        <div id="statusBadge" class="status-badge disconnected">
          <span class="status-dot"></span> <span id="statusText">OFFLINE</span>
        </div>
      </div>

      <div id="chatBox">
        <div style="text-align:center; opacity:0.3; margin-top:50px;">
          <i class="fas fa-satellite-dish" style="font-size:3rem; margin-bottom:15px;"></i>
          <p>Awaiting Signal...</p>
        </div>
      </div>

      <div class="typing-wrapper">
        <div id="typingIndicator" class="typing-indicator">
          > Remote User is typing...
        </div>
      </div>

      <div class="chat-controls">
        <div class="input-group" style="margin-bottom:10px;">
          <i class="fas fa-hashtag"></i>
          <input id="receiverId" placeholder="Room ID / User ID" />
        </div>
        
        <div style="display: flex; gap: 10px; margin-bottom: 12px;">
          <textarea id="messageContent" rows="1" placeholder="Enter command sequence..." style="resize:none;"></textarea>
          <button class="btn btn-primary" style="width: auto; padding: 0 25px;" onclick="sendMessage()">
            <i class="fas fa-paper-plane"></i>
          </button>
        </div>

        <div class="action-row" style="display:flex; gap:10px;">
          <button class="btn btn-secondary" onclick="emitTyping(true)" style="flex:1;">
            <i class="fas fa-keyboard"></i> TYPING ON
          </button>
          <button class="btn btn-secondary" onclick="emitTyping(false)" style="flex:1;">
             <i class="fas fa-stop"></i> TYPING OFF
          </button>
        </div>
      </div>
    </div>
  </div>

<script>
  // --- AUDIO ENGINE (Web Audio API) ---
  const AudioEngine = {
    ctx: null,
    muted: false,
    
    init() {
      if (!this.ctx) this.ctx = new (window.AudioContext || window.webkitAudioContext)();
    },

    playTone(freq, type, duration, vol = 0.1) {
      if (this.muted || !this.ctx) return;
      const osc = this.ctx.createOscillator();
      const gain = this.ctx.createGain();
      
      osc.type = type;
      osc.frequency.setValueAtTime(freq, this.ctx.currentTime);
      
      gain.gain.setValueAtTime(vol, this.ctx.currentTime);
      gain.gain.exponentialRampToValueAtTime(0.01, this.ctx.currentTime + duration);

      osc.connect(gain);
      gain.connect(this.ctx.destination);
      osc.start();
      osc.stop(this.ctx.currentTime + duration);
    },

    playConnect() {
      this.init();
      // Ascending Arpeggio
      const now = this.ctx.currentTime;
      [440, 554, 659, 880].forEach((f, i) => {
        setTimeout(() => this.playTone(f, 'sine', 0.3, 0.1), i * 100);
      });
    },

    playDisconnect() {
      if(!this.ctx) return;
      this.playTone(150, 'sawtooth', 0.5, 0.1);
      setTimeout(() => this.playTone(100, 'sawtooth', 0.5, 0.1), 200);
    },

    playSend() {
      this.playTone(800, 'sine', 0.1, 0.05);
      setTimeout(() => this.playTone(1200, 'triangle', 0.1, 0.05), 50);
    },

    playReceive() {
      this.playTone(600, 'sine', 0.2, 0.1);
      setTimeout(() => this.playTone(800, 'sine', 0.4, 0.05), 100);
    },

    playTypingStart() {
       this.playTone(800, 'square', 0.05, 0.02);
    },

    playTypingStop() {
      this.playTone(400, 'square', 0.05, 0.02);
    },

    playClear() {
      if (!this.muted && this.ctx) {
        // Noise burst for clear
        const bufferSize = this.ctx.sampleRate * 0.2; // 0.2 seconds
        const buffer = this.ctx.createBuffer(1, bufferSize, this.ctx.sampleRate);
        const data = buffer.getChannelData(0);
        for (let i = 0; i < bufferSize; i++) {
          data[i] = Math.random() * 2 - 1;
        }
        const noise = this.ctx.createBufferSource();
        noise.buffer = buffer;
        const gain = this.ctx.createGain();
        gain.gain.setValueAtTime(0.1, this.ctx.currentTime);
        gain.gain.exponentialRampToValueAtTime(0.001, this.ctx.currentTime + 0.2);
        noise.connect(gain);
        gain.connect(this.ctx.destination);
        noise.start();
      }
    }
  };

  function toggleMute() {
    AudioEngine.muted = !AudioEngine.muted;
    const icon = document.getElementById("muteIcon");
    icon.className = AudioEngine.muted ? "fas fa-volume-mute" : "fas fa-volume-up";
    icon.style.color = AudioEngine.muted ? "var(--secondary)" : "var(--primary)";
  }


  // --- UI LOGIC ---
  function toggleSidebar() {
    document.getElementById('sidebar').classList.toggle('active');
    document.querySelector('.overlay').classList.toggle('active');
  }

  // --- PARTICLES ---
  const canvas = document.getElementById('canvas-bg');
  const ctx = canvas.getContext('2d');
  let particles = [];

  function resizeCanvas() {
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
  }
  window.addEventListener('resize', resizeCanvas);
  resizeCanvas();

  class Particle {
    constructor() {
      this.reset();
    }
    reset() {
      this.x = Math.random() * canvas.width;
      this.y = Math.random() * canvas.height;
      this.vx = (Math.random() - 0.5) * 0.5;
      this.vy = (Math.random() - 0.5) * 0.5;
      this.size = Math.random() * 2;
      this.alpha = Math.random() * 0.5 + 0.1;
      this.color = Math.random() > 0.5 ? '#00f2ea' : '#ff0050';
    }
    update() {
      this.x += this.vx; this.y += this.vy;
      if (this.x < 0 || this.x > canvas.width || this.y < 0 || this.y > canvas.height) this.reset();
    }
    draw() {
      ctx.beginPath(); ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
      ctx.fillStyle = this.color; ctx.globalAlpha = this.alpha; ctx.fill();
    }
  }

  function initParticles() {
    particles = []; for(let i=0; i<60; i++) particles.push(new Particle());
  }
  function animateParticles() {
    ctx.clearRect(0,0,canvas.width, canvas.height);
    particles.forEach(p => { p.update(); p.draw(); });
    
    // Draw connecting lines
    ctx.strokeStyle = 'rgba(0, 242, 234, 0.05)';
    ctx.lineWidth = 1;
    for(let i=0; i<particles.length; i++) {
      for(let j=i; j<particles.length; j++) {
        const dx = particles[i].x - particles[j].x;
        const dy = particles[i].y - particles[j].y;
        const dist = Math.sqrt(dx*dx + dy*dy);
        if(dist < 100) {
          ctx.beginPath(); ctx.moveTo(particles[i].x, particles[i].y);
          ctx.lineTo(particles[j].x, particles[j].y); ctx.stroke();
        }
      }
    }
    requestAnimationFrame(animateParticles);
  }
  initParticles(); animateParticles();


  // --- SOCKET LOGIC ---
  let socket = null;
  let timerInt = null;
  let startTime = null;

  function addLog(msg, type = "info") {
    const el = document.createElement("div");
    el.className = `log-entry ${type}`;
    const time = new Date().toLocaleTimeString().split(' ')[0];
    el.innerHTML = `<span style="opacity:0.6">[${time}]</span> ${msg}`;
    const box = document.getElementById("logContainer");
    box.appendChild(el);
    box.scrollTop = box.scrollHeight;
  }

  function addChatMessage(content, type) {
    const box = document.getElementById("chatBox");
    // Remove empty placeholder if exists
    if(box.querySelector('.fa-satellite-dish')) box.innerHTML = '';
    
    const msg = document.createElement("div");
    msg.className = `message ${type}`;
    
    const time = new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
    msg.innerHTML = `${content} <span class="message-meta">${time}</span>`;
    
    box.appendChild(msg);
    box.scrollTo({ top: box.scrollHeight, behavior: 'smooth' });
    
    if(type === 'other') AudioEngine.playReceive();
    if(type === 'me') AudioEngine.playSend();
  }

  function toggleConnection() {
    AudioEngine.init(); // Initialize audio context on user interaction
    
    if (socket && socket.connected) {
      socket.disconnect();
    } else {
      const url = document.getElementById("serverUrl").value;
      const token = document.getElementById("token").value;
      const options = { transports: ['websocket'] };
      if(token) options.auth = { token };

      socket = io(url, options);

      socket.on("connect", () => {
        setUIConnected(true);
        addLog("Uplink Established", "success");
        AudioEngine.playConnect();
      });

      socket.on("connect_error", (err) => {
        addLog(`Connection Error: ${err.message}`, "error");
        AudioEngine.playDisconnect();
      });

      socket.on("disconnect", () => {
        setUIConnected(false);
        addLog("Link Severed", "error");
        AudioEngine.playDisconnect();
      });

      // --- FIXED MESSAGE PARSER ---
      socket.on("receive_message", (data) => {
        let content = "";
        
        if (typeof data === 'string') {
          content = data;
        } else if (data && typeof data === 'object') {
          // Check for common property names: content, message, text, msg
          content = data.content || data.message || data.text || data.msg || JSON.stringify(data);
          
          // If extracted content is STILL an object (recursive check), stringify it
          if (typeof content === 'object') {
             content = content.content || content.text || JSON.stringify(content);
          }
        } else {
          content = String(data);
        }

        addChatMessage(content, "other");
        addLog("Data Packet Received");
      });

      socket.on("user_typing", (data) => {
        const ind = document.getElementById("typingIndicator");
        const isTyping = data.isTyping || data.typing; // Handle different server impls
        
        if(isTyping && ind.style.display !== 'block') {
           AudioEngine.playTypingStart();
           ind.style.display = 'block';
           ind.textContent = `> User ${data.userId || 'Remote'} is typing...`;
        } else if (!isTyping && ind.style.display === 'block') {
           AudioEngine.playTypingStop();
           ind.style.display = 'none';
        }
      });
    }
  }

  function setUIConnected(isConn) {
    const btn = document.getElementById("connectBtn");
    const badge = document.getElementById("statusBadge");
    const statusText = document.getElementById("statusText");
    
    if (isConn) {
      badge.className = "status-badge connected";
      statusText.textContent = "ONLINE";
      btn.innerHTML = `<i class="fas fa-power-off"></i> TERMINATE LINK`;
      btn.className = "btn btn-danger";
      
      startTime = Date.now();
      timerInt = setInterval(() => {
        const s = Math.floor((Date.now() - startTime)/1000);
        document.getElementById("timeDisplay").textContent = 
          `${Math.floor(s/60).toString().padStart(2,'0')}:${(s%60).toString().padStart(2,'0')}`;
      }, 1000);
    } else {
      badge.className = "status-badge disconnected";
      statusText.textContent = "OFFLINE";
      btn.innerHTML = `<i class="fas fa-bolt"></i> INITIALIZE LINK`;
      btn.className = "btn btn-primary";
      clearInterval(timerInt);
    }
  }

  function sendMessage() {
    if (!socket?.connected) return addLog("Network Offline: Cannot Send", "error");
    const content = document.getElementById("messageContent").value;
    const receiver = document.getElementById("receiverId").value;
    if(!content) return;

    addChatMessage(content, "me");
    socket.emit("send_message", { receiverId: receiver, content });
    document.getElementById("messageContent").value = "";
  }

  function emitTyping(isStart) {
    if (!socket?.connected) return addLog("Network Offline", "error");
    const receiver = document.getElementById("receiverId").value;
    
    // Play local sound for feedback
    if(isStart) AudioEngine.playTypingStart();
    else AudioEngine.playTypingStop();

    const eventName = isStart ? "typing_start" : "typing_stop";
    socket.emit(eventName, { receiverId: receiver });
    addLog(`Sent signal: ${eventName}`);
  }

  function clearLogs() {
    AudioEngine.playClear();
    document.getElementById("logContainer").innerHTML = "";
  }
</script>
</body>
</html>